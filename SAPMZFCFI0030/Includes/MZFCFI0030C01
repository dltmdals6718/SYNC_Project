*&---------------------------------------------------------------------*
*& Include          MZFCFI0030C01
*&---------------------------------------------------------------------*
CLASS LCL_OPEN_ITEM_EVENT_HANDLER DEFINITION.
  PUBLIC SECTION.
    CLASS-METHODS:
      ON_TOOLBAR FOR EVENT TOOLBAR
        OF CL_GUI_ALV_GRID
        IMPORTING E_OBJECT,
      ON_USER_COMMAND FOR EVENT USER_COMMAND
        OF CL_GUI_ALV_GRID
        IMPORTING E_UCOMM,
      ON_HOTSPOT_CLICK FOR EVENT HOTSPOT_CLICK
        OF CL_GUI_ALV_GRID
        IMPORTING ES_ROW_NO E_COLUMN_ID.
ENDCLASS.

CLASS LCL_OPEN_ITEM_EVENT_HANDLER IMPLEMENTATION.

  METHOD ON_TOOLBAR.
    DATA: LS_BUTTON TYPE STB_BUTTON.

    LS_BUTTON-BUTN_TYPE = 3.
    APPEND LS_BUTTON TO E_OBJECT->MT_TOOLBAR.

    CLEAR LS_BUTTON.
    LS_BUTTON-FUNCTION = 'HISTORY'.
    LS_BUTTON-BUTN_TYPE = 0.
    LS_BUTTON-ICON = ICON_DETAIL.
    LS_BUTTON-TEXT = ' 반제 이력 조회'.
    APPEND LS_BUTTON TO E_OBJECT->MT_TOOLBAR.

    CLEAR LS_BUTTON.
    LS_BUTTON-FUNCTION = 'CLEARING'.
    LS_BUTTON-BUTN_TYPE = 0.
    LS_BUTTON-ICON = ICON_INTENSIFY.
    LS_BUTTON-TEXT = ' 반제 처리'.
    APPEND LS_BUTTON TO E_OBJECT->MT_TOOLBAR.

  ENDMETHOD.

  METHOD ON_USER_COMMAND.

    CASE E_UCOMM.
      WHEN 'HISTORY'.
        PERFORM HISTORY_SELECTED_OPEN_ITEM.
      WHEN 'CLEARING'.
        PERFORM CLEARING_SELECTED_OPEN_ITEM.
    ENDCASE.

  ENDMETHOD.

  METHOD ON_HOTSPOT_CLICK.

    READ TABLE GT_OPEN_ITEM INTO GS_OPEN_ITEM INDEX ES_ROW_NO-ROW_ID.
    IF SY-SUBRC <> 0.
      MESSAGE 'READ ROW ERROR' TYPE 'S' DISPLAY LIKE 'E'.
      RETURN.
    ENDIF.

    CASE E_COLUMN_ID-FIELDNAME.
      WHEN 'BELNR'. " 전표 번호
        CALL SCREEN 140
          STARTING AT 5 5.
      WHEN 'LIFNR'. " 공급업체 번호
        CALL SCREEN 150
          STARTING AT 5 5.
      WHEN 'INVNR'. " 송장 번호
        CALL SCREEN 170
          STARTING AT 5 5.
    ENDCASE.
  ENDMETHOD.

ENDCLASS.

CLASS LCL_ITEM_EVENT_HANDLER DEFINITION.
  PUBLIC SECTION.
    CLASS-METHODS:
      ON_HOTSPOT_CLICK FOR EVENT HOTSPOT_CLICK
        OF CL_GUI_ALV_GRID
        IMPORTING ES_ROW_NO E_COLUMN_ID.
ENDCLASS.

CLASS LCL_ITEM_EVENT_HANDLER IMPLEMENTATION.

  METHOD ON_HOTSPOT_CLICK.

    READ TABLE GT_OPEN_ITEM_HISTORY INTO GS_OPEN_ITEM_HISTORY INDEX ES_ROW_NO-ROW_ID.
    IF SY-SUBRC <> 0.
      MESSAGE 'READ ROW ERROR' TYPE 'S' DISPLAY LIKE 'E'.
      RETURN.
    ENDIF.

    CASE E_COLUMN_ID-FIELDNAME.
      WHEN 'BELNR'.
        CALL SCREEN 160
          STARTING AT 5 5.
      WHEN 'PERNAME'.
        CALL SCREEN 180
          STARTING AT 5 5.
    ENDCASE.

  ENDMETHOD.

ENDCLASS.
